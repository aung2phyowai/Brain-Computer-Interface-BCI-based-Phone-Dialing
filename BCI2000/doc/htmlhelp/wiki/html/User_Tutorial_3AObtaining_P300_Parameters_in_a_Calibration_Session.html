<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<head>
<title>User Tutorial:Obtaining P300 Parameters in a Calibration Session - BCI2000 Help</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="User Tutorial:Obtaining P300 Parameters in a Calibration Session,User Reference:BCI2000 Offline Analysis,User Reference:P300Classifier,User Tutorial:P300 BCI Tutorial,User Tutorial:Performing a P300 Spelling Session" />
<link rel="shortcut icon" href="../../favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../skins/common/wikiprintable.css' />
<link rel="stylesheet" href="../skins/common/wikistandard.css@1" type="text/css" />
<link rel="stylesheet" href="../skins/common/common.css" type="text/css" />
<link rel="stylesheet" href="../skins/common/htmlhelp.css" type="text/css" />

<style type='text/css'>
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px;  }
#article { margin-left: 152px; margin-right: 4px; }
</style>
</head>

<body bgcolor='#FFFFFF'>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
</tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">Obtaining P300 Parameters in a Calibration Session</h1><p class="subtitle">User Tutorial</p><hr class="sep" /><table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_a_Calibration_Session.html#Obtaining_P300_Parameters_in_the_Calibration_Session"><span class="tocnumber">1</span> <span class="toctext">Obtaining P300 Parameters in the Calibration Session</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_a_Calibration_Session.html#Design_of_Calibration_Session"><span class="tocnumber">2</span> <span class="toctext">Design of Calibration Session</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_a_Calibration_Session.html#Performing_the_Calibration_Session"><span class="tocnumber">3</span> <span class="toctext">Performing the Calibration Session</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_a_Calibration_Session.html#Analyzing_The_Calibration_Session_with_Offline_Analysis"><span class="tocnumber">4</span> <span class="toctext">Analyzing The Calibration Session with Offline Analysis</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_a_Calibration_Session.html#Creating_a_subject-specific_parameter_file"><span class="tocnumber">5</span> <span class="toctext">Creating a subject-specific parameter file</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_a_Calibration_Session.html#P300Classifier"><span class="tocnumber">6</span> <span class="toctext">P300Classifier</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_a_Calibration_Session.html#Next_Step"><span class="tocnumber">7</span> <span class="toctext">Next Step</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_a_Calibration_Session.html#See_also"><span class="tocnumber">8</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></table>
<a name="Obtaining_P300_Parameters_in_the_Calibration_Session"></a><h2>Obtaining P300 Parameters in the Calibration Session</h2>
<p>Although the basic properties of the P300 evoked potential are the same for all individuals, the response's latency, width, and spatial pattern varies, and adaptation to individual parameters improves accuracy.
</p><p>Thus, it is necessary to obtain these individual parameters prior to performing spelling experiments.
</p>
<a name="Design_of_Calibration_Session"></a><h2>Design of Calibration Session</h2>
<p>During the calibration session, the subject is asked to spell out a given word by using a P300 character matrix, pictured below. During each run, the subject is asked to focus on the next letter in the word he is spelling, as the rows and columns flash randomly and successively so that sometimes the flashing corresponds to the column or row containing the target character and sometimes it will not. As the subject counts the number of times the desired letter in the word flashes, a P300 response is generated. The purpose of the calibration session is to identify those features that discriminate between the desired and undesired rows/columns. 
</p><p><a href="../images/thumb/e/ea/P3SpellerMatrix.PNG/298px-P3SpellerMatrix.PNG" class="image" title=""><img src="../images/thumb/e/ea/P3SpellerMatrix.PNG/298px-P3SpellerMatrix.PNG" alt="" width="298" height="297" longdesc="/wiki/index.php/Image:P3SpellerMatrix.PNG" /></a>
</p><p>After the first few runs are collected, we will use the BCI2000 "Offline Analysis" tool to determine which features (in this case, signals at a particular location and time after the stimulus) correspond to the row or column of the desired character.
</p>
<a name="Performing_the_Calibration_Session"></a><h2>Performing the Calibration Session</h2>
<ul><li>Start BCI2000 by running <tt>batch/P3Speller_&lt;Your_Amplifier&gt;.bat</tt>
</li><li>Press <b>Config</b>, and load the baseline parameters for copy spelling that you made earlier.
</li><li>In the <b>Storage</b> tab:
<ul><li>Set <i>SubjectName</i> to the subject's initials.
</li><li>Set <i>SubjectSession</i> to <tt>001</tt>
</li><li>Set <i>SubjectRun</i> to <tt>01</tt>
</li></ul>
</li><li>In the <b>Application</b> tab:
<ul><li>Make sure that <i>InterpretMode</i> is set to <tt>copy mode</tt>, and <i>DisplayResults</i> (directly below InterpretMode) is unchecked
</li><li>Find the <i>TextToSpell</i> field. This should be set to ‘THE’, and you will be changing it after each run. 
</li></ul>
</li><li>Press <b>Set Config</b> to apply this configuration.
</li></ul>
<ul><li>Request that the subject sit in a relaxed position, and that the subject not move or speak during the runs.
</li><li>Turning off or dimming the lights can improve the subject's focus and performance.
</li><li>Showing the brain wave readouts to the subject can help understanding how artifact-generating behavior can be detrimental to the data.
</li><li>Press <b>Start</b> to show the flashing character matrix, and describe what the subject is expected to do.
</li><li>After you’ve explained the procedure, click <b>Suspend</b> to stop.
</li><li>Delete that run of data (the file will be found at <tt>data\P300\&lt;Subject Initials&gt;001\&lt;Subject Initials&gt;S001R01.dat</tt>).
</li></ul>
<ul><li>Press <b>Start</b> to record the run.
</li><li>Once it has finished automatically, click <b>Config</b> and change the <i>TextToSpell</i> in the <b>Application</b> tab to <tt>QUICK</tt>.
</li><li>Press <b>Start</b> to record the run.
</li><li>Once it has finished automatically, click <b>Config</b> and change the <i>TextToSpell</i> in the <b>Application</b> tab to <tt>BROWN</tt>.
</li><li>Press <b>Start</b> to record the run.
</li><li>Once it has finished automatically, click <b>Config</b> and change the <i>TextToSpell</i> in the <b>Application</b> tab to <tt>FOX</tt>.
</li><li>Press <b>Start</b> to record the run.
</li><li>Once this recording has finished, close BCI2000 and locate the saved data files below the BCI2000 <tt>data</tt> directory.
</li></ul>
<a name="Analyzing_The_Calibration_Session_with_Offline_Analysis"></a><h2>Analyzing The Calibration Session with Offline Analysis</h2>
<p>We will now use the BCI2000 "Offline Analysis" tool to analyze the subject's initial session.
</p>
<ul><li>Start the <a href="User_Reference%253ABCI2000_Offline_Analysis.html" title="User Reference:BCI2000 Offline Analysis">BCI2000 Offline Analysis</a> tool:
<ul><li>If you have a version of Matlab installed, run <tt>tools/OfflineAnalysis/OfflineAnalysis.bat</tt>.
</li><li>Otherwise, follow the instructions provided <a href="User_Reference%253ABCI2000_Offline_Analysis.html#Systems_that_do_not_have_MATLAB_installed_or_with_versions_that_predate_MATLAB_v7.0" title="User Reference:BCI2000 Offline Analysis">elsewhere</a>.
</li></ul>
</li></ul>
<div class="floatright"><span><a href="../images/8/89/OfflineGUI.PNG" class="image" title=""><img src="../images/8/89/OfflineGUI.PNG" alt="" width="554" height="507" longdesc="/wiki/index.php/Image:OfflineGUI.PNG" /></a></span></div>
<ul><li>In the <i>Analysis Domain</i> field, choose <b>Time (P300)</b>
</li><li>In the <i>Acquisition Type</i> field, choose <b>EEG</b>
</li><li>Next to <i>Spatial Filter</i>, choose <b>Common Average Reference (CAR)</b>
</li><li>For <b>Trial Change Condition</b> enter <tt>states.StimulusBegin == 1</tt>
</li><li>For <b>Target Condition 1</b> enter <tt>(states.StimulusCode &gt; 0) &amp; (states.StimulusType == 1)</tt>
</li><li>For <b>Target Condition Label 1</b> enter <tt>Attended Stimuli</tt>
<ul><li>‘Attended Stimuli’ refers to the letter or character the person is counting the flashes of, and triggers when the desired letter is flashed
</li></ul>
</li><li>For <b>Target Condition 2</b> enter <tt>(states.StimulusCode &gt; 0) &amp; (states.StimulusType == 0)</tt>
</li><li>For <b>Target Condition Label 2</b> enter <tt>Unattended Stimuli</tt>
<ul><li>‘Unattended stimulus’ refers to the letters or characters the person is not counting the flashes of, and triggers when the desired letter is not flashed 
</li></ul>
</li><li>Click the <b>Add</b> button by <i>Data Files</i>
</li><li>In this new dialog, select all of the data files taken during this configuration session, and click <b>Open</b>
</li></ul>
<ul><li>Click <b>Generate Plots</b> and wait for the feature plot to appear
</li></ul>
<table>
<tr>
<td height="160px">
</td></tr></table>
<div class="floatright"><span><a href="../images/thumb/a/a9/FeaturesPlot.PNG/500px-FeaturesPlot.PNG" class="image" title=""><img src="../images/thumb/a/a9/FeaturesPlot.PNG/500px-FeaturesPlot.PNG" alt="" width="500" height="472" longdesc="/wiki/index.php/Image:FeaturesPlot.PNG" /></a></span></div>
<ul><li>When this is complete, you will see a feature plot similar to the one to the right. The vertical axis corresponds to the locations while the horizontal corresponds to the time delay after the stimulus. The color coding shows the r-squared value of that datapoint, with dark red colors indicating a high predictability that a response is produced by the desired letter being flashed.
</li><li>The largest of these r-squared values between 250 and 550ms are what we are interested in. Pick the 4 points with the largest r-squared values between these times and record their time points and channels. The plot’s <i>Data Cursor</i> tool (Tools Menu &rarr; Data Cursor) allows for discrete identification of time points.
</li></ul>
<ul><li>With these four points, close the feature plot, and enter the channel numbers of the data points you found into the <i>Waveform Channels</i> field and the time points into the <i>Topo Times</i> field.
<ul><li>In the example above, the four best data points have r-squared values <tt>0.02218</tt>, <tt>0.02179</tt>, <tt>0.01928</tt>, and <tt>0.019</tt>, occur at times <tt>388.7ms</tt>, <tt>392.6ms</tt>, <tt>384.8ms</tt>, and <tt>365.2ms</tt> respectively, and all four are located in channel six. <tt>6, 6, 6, 6</tt> would be entered into <i>Waveform Channels</i> and <tt>388.7, 392.6, 384.8, 365.2</tt> would be entered into the <i>Topo Times</i> field. The order of the data points here does not matter, only that they are in the same order in both fields.
</li><li>If there are less than four points that seem appropriate, either because they are at the wrong electrodes, at the wrong times, or simply have too low of an r-squared value, that is fine, three or two values can work, though the fewer values used the lower the accuracy will be.
</li><li>Additionally, it may be helpful to re-run the analysis by setting the <i>Spatial Filter</i> to <b>None</b>, particularly when few channels are used.
</li></ul>
</li><li>Click <b>Generate Plots</b> to create the features plot again with a set of four graphs that show the correlation between the selected times after the desired stimulus is given (the red line) and the brain’s responses to when the desired stimulus is not given (the blue line).
<ul><li>As seen below, the attended-stimulus reaction will typically be stronger than for the unattended stimuli, but in some cases the reverse is true. If the ‘unattended’ curve is larger than the ‘attended’ curve then make a note of this before moving on. The waveform seen here is similar to the others generated, only one is shown here for simplicity.
</li><li>Additionally before moving on, determine the location of the response seen. The P300 response is generally observed centered on the Cz electrode, or just behind and directly in between the ears, and does not involve the frontal regions of the brain. Assuming these characteristics are present, it is proper to proceed.
</li></ul>
</li></ul>
<div class="center"><div class="floatnone"><span><a href="../images/thumb/1/1d/Waveform.PNG/800px-Waveform.PNG" class="image" title=""><img src="../images/thumb/1/1d/Waveform.PNG/800px-Waveform.PNG" alt="" width="800" height="391" longdesc="/wiki/index.php/Image:Waveform.PNG" /></a></span></div></div>
<a name="Creating_a_subject-specific_parameter_file"></a><h2>Creating a subject-specific parameter file</h2>
<p>Now we will save these customizations to a subject-specific parameter file that will allow the subject to free-spell with good accuracy.
</p>
<ul><li>Start BCI2000 using <tt>batch/P3Speller_&lt;Your_Amplifier&gt;.bat</tt> file
</li><li>Click <b>Config</b>, and load the baseline parameters for copy spelling that you used for recording the calibration session
</li><li>Under the <b>Storage</b> tab, set the <i>SubjectSession</i> parameter to "002", and the <b>SubjectName</b> parameter to the subject's initials.
</li><li>Under the <b>Source</b> tab, set the <i>TransmitChList</i> parameter to a list of channels from 1 to the number of channels recorded.
</li><li>Under the <b>Filtering</b> tab, click the <b>Edit Matrix</b> button by <i>Classifier</i> near the bottom
</li><li>Change this matrix to have 4 columns and as many rows as values you are using, and click <b>Set New Matrix Size</b>
<ul><li>In the first column, labeled <i>Input Channel</i>, enter the channel of the first value you use
</li><li>In the second column, labeled <i>Input Element (bin)</i>, enter the time of the best classification, immediately followed with <tt>ms</tt>, as in <tt>388.7ms</tt>
</li><li>In the third column, enter 1 as the output channel
</li><li>In the fourth column, enter 1 if the <i>Attended</i> line was larger than the <i>Unattended</i> line, -1 if the <i>unattended</i> line was larger than the <i>attended</i> line
</li><li>Repeat these steps for the remaining rows, and close the matrix when finished
</li></ul>
</li><li> If a <b>Common Average Reference</b> was used in the analysis, under the <b>Filtering</b> tab change the <b>SpatialFilterType</b> parameter to <b>Common Average Reference (CAR)</b>; otherwise, leave it as <b>None</b>.
</li><li>Click <b>Save Parameters</b> to save this file as <tt>&lt;SubjectName&gt;_CopySpelling.prm</tt>.
</li><li>Use this new parameter file to repeat the configuration session and data analysis a few times, adding new rows to the classifier matrix each time for new data points to be utilized.
</li><li>When accuracy is reliably above 90%, click <b>Config,</b> and click on the <b>Application</b> tab:
<ul><li>Delete the contents of the <i>Text to Spell</i> field
</li><li>Set <i>InterpretMode</i> &rarr; <tt>online free mode</tt>
</li><li>Make sure the <i>DisplayResults</i> box is checked
</li><li>Click on <b>Edit Matrix</b> next to <i>TargetDefinitions</i> and scroll to the bottom:
<ul><li>In the first column replace <tt>9</tt> with <tt>BS</tt> (for "backspace")
</li><li>In the second column replace <tt>9</tt> with <tt>&lt;BS&gt;</tt>
</li></ul>
</li></ul>
</li><li>Click <b>Save Parameters</b>, and change the <tt>CopySpelling</tt> portion of this parameter file name to <tt>FreeSpelling</tt>
</li><li>This parameter file is now ready to use for that specific subject for future P300 spelling experiments
</li></ul>
<a name="P300Classifier"></a><h2>P300Classifier</h2>
<p>The use of the "Offline Analysis" program was provided to familiarize you with the characteristics of the P300 response.
At the same time, manually selecting the best features will typically result in reduced performance compared to when the features are automatically selected. Such automatic selection is performed using the <i>P300Classifier</i> tool that is provided with BCI2000. This stand-alone program determines optimal features (i.e., signal times and channels) and corresponding weights automatically, and outputs those in a classifier matrix. Use of this program streamlines the configuration process at the expense of decreased hands-on experience with BCI data and the BCI2000 program itself.
</p><p>For instructions on using the P300Classifier, see <a href="User_Reference%253AP300Classifier.html" title="User Reference:P300Classifier">User Reference:P300Classifier</a>.
</p>
<a name="Next_Step"></a><h2>Next Step</h2>
<p>To continue onto performing P300 spelling experiments, continue to <a href="User_Tutorial%253APerforming_a_P300_Spelling_Session.html" title="User Tutorial:Performing a P300 Spelling Session">Performing a P300 Spelling Session</a>.
</p>
<a name="See_also"></a><h2>See also</h2>
<p><a href="User_Tutorial%253AP300_BCI_Tutorial.html" title="User Tutorial:P300 BCI Tutorial">User Tutorial:P300 BCI Tutorial</a>
</p>
<div class="printfooter">
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'></td></tr></table>
</div>
</div>

<div id='quickbar'>
<table class="image"><caption align="bottom"><h2>BCI2000 Help</h2></caption><tr><td><a href="BCI2000_Help.html"><img src='../../images/bci2000logo_small.png' height=100 width=100 alt='[BCI2000 Help]' /></a></td></tr></table>
<hr class='sep' /><a href="User_Tutorial%253ABCI2000_Tour.html">Getting Started</a><br />
<ul><li><a href="User_Tutorial%253ABCI2000_Tour.html">Tour</a></li>
<li><a href="User_Tutorial%253AMu_Rhythm_BCI_Tutorial.html">Mu Tutorial</a></li>
<li><a href="User_Tutorial%253AP300_BCI_Tutorial.html">P300 Tutorial</a></li>
</ul><a href="User_Reference%253AContents.html">User Manual</a><br />
<a href="Technical_Reference%253AContents.html">Technical Reference</a><br />
<a href="Programming_Reference%253AContents.html">Programming Manual</a><br />
<a href="Contributions%253AContents.html">Contributions</a><br />
<hr class='sep' />
<a href="BCI2000_Glossary.html">BCI2000 Glossary</a><br />
</div>

</body></html>
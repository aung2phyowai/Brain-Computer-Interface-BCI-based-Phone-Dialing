<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<head>
<title>User Reference:SpatialFilter - BCI2000 Help</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="User Reference:SpatialFilter,User Reference:DataIOFilter,User Reference:LinearClassifier,User Reference:Parameters" />
<link rel="shortcut icon" href="../../favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../skins/common/wikiprintable.css' />
<link rel="stylesheet" href="../skins/common/wikistandard.css@1" type="text/css" />
<link rel="stylesheet" href="../skins/common/common.css" type="text/css" />
<link rel="stylesheet" href="../skins/common/htmlhelp.css" type="text/css" />

<style type='text/css'>
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px;  }
#article { margin-left: 152px; margin-right: 4px; }
</style>
</head>

<body bgcolor='#FFFFFF'>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
</tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">SpatialFilter</h1><p class="subtitle">User Reference</p><hr class="sep" /><table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="User_Reference%253ASpatialFilter.html#Function"><span class="tocnumber">1</span> <span class="toctext">Function</span></a></li>
<li class='toclevel-1'><a href="User_Reference%253ASpatialFilter.html#Parameters"><span class="tocnumber">2</span> <span class="toctext">Parameters</span></a>
<ul>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#SpatialFilterType"><span class="tocnumber">2.1</span> <span class="toctext">SpatialFilterType</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#SpatialFilter"><span class="tocnumber">2.2</span> <span class="toctext">SpatialFilter</span></a>
<ul>
<li class='toclevel-3'><a href="User_Reference%253ASpatialFilter.html#Full_Matrix_Filter_Type"><span class="tocnumber">2.2.1</span> <span class="toctext">Full Matrix Filter Type</span></a></li>
<li class='toclevel-3'><a href="User_Reference%253ASpatialFilter.html#Sparse_Matrix_Filter_Type"><span class="tocnumber">2.2.2</span> <span class="toctext">Sparse Matrix Filter Type</span></a></li>
</ul>
</li>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#SpatialFilterCAROutput"><span class="tocnumber">2.3</span> <span class="toctext">SpatialFilterCAROutput</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#SpatialFilterMissingChannels"><span class="tocnumber">2.4</span> <span class="toctext">SpatialFilterMissingChannels</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="User_Reference%253ASpatialFilter.html#States"><span class="tocnumber">3</span> <span class="toctext">States</span></a></li>
<li class='toclevel-1'><a href="User_Reference%253ASpatialFilter.html#Examples"><span class="tocnumber">4</span> <span class="toctext">Examples</span></a>
<ul>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#Linked_Mastoids_.28Full_Matrix.29"><span class="tocnumber">4.1</span> <span class="toctext">Linked Mastoids (Full Matrix)</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#Sparse_Matrix"><span class="tocnumber">4.2</span> <span class="toctext">Sparse Matrix</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#Large_Laplacian_.28Sparse_Matrix.29"><span class="tocnumber">4.3</span> <span class="toctext">Large Laplacian (Sparse Matrix)</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="User_Reference%253ASpatialFilter.html#Performance_Notes"><span class="tocnumber">5</span> <span class="toctext">Performance Notes</span></a>
<ul>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#None"><span class="tocnumber">5.1</span> <span class="toctext">None</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#CAR"><span class="tocnumber">5.2</span> <span class="toctext">CAR</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#Sparse_Matrix_2"><span class="tocnumber">5.3</span> <span class="toctext">Sparse Matrix</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253ASpatialFilter.html#Full_Matrix"><span class="tocnumber">5.4</span> <span class="toctext">Full Matrix</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="User_Reference%253ASpatialFilter.html#See_also"><span class="tocnumber">6</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></table>
<a name="Function"></a><h2>Function</h2>
<p>The SpatialFilter computes an instantaneous linear transformation of its input. Typically, the SpatialFilter's input is the unfiltered brain signal from the source module. The linear transformation that is applied by the spatial filter is described by a transformation matrix, and applied for each sample separately, not linking data across different points in time. This linear transformation can be parameterized in three different ways as described below.
</p>
<a name="Parameters"></a><h2>Parameters</h2>
<a name="SpatialFilterType"></a><h3>SpatialFilterType</h3>
<p>This parameter defines the method that will be used to design the spatial filter. Choices are:
</p>
<dl><dt>0 None
</dt><dd>No spatial filtering is performed; the input signal is copied to the output signal, and the spatial filter matrix is ignored.
</dd><dt>1 Full Matrix
</dt><dd>The linear transformation applied to the input signal is defined by the <i>SpatialFilter</i> matrix parameter. This is the is also the default, and matches behavior in previous versions of BCI2000.
</dd><dt>2 Sparse Matrix
</dt><dd>The sparse matrix filter uses the <i>SpatialFilter</i> matrix parameter to define non-zero matrix entries. Each non-zero entry is given by an input channel, output channel, and weight for that channel.
</dd><dt>3 Common Average Reference (CAR)
</dt><dd>The common average reference spatial filter calculates the mean of all channels, and subtracts this value from the selected output channels. This filter's output channels may be defined by the <i>SpatialFilterCAROutput</i> parameter.
</dd></dl>
<a name="SpatialFilter"></a><h3>SpatialFilter</h3>
<a name="Full_Matrix_Filter_Type"></a><h4>Full Matrix Filter Type</h4>
<div class="floatright"><span><a href="../images/thumb/f/f0/SpatialFilter.png/256px-SpatialFilter.png" class="image" title=""><img src="../images/thumb/f/f0/SpatialFilter.png/256px-SpatialFilter.png" alt="" width="256" height="181" longdesc="/wiki/index.php/Image:SpatialFilter.png" /></a></span></div>
<p>The full matrix filter uses the SpatialFilter parameter to define the linear transformation applied to the filter's input signal. In this matrix, columns represent input channels, and rows represent output channels. Each matrix element defines a weight with which the respective input channel (column) enters into the respective output channel (row).
</p><p>If the spatial filter is an identity filter -- not modifying its input --, then the SpatialFilter matrix is a unit matrix (square matrix with ones on the main diagonal, and all other elements zero).
</p><p>In a typical EEG experiment with fixed montage, you might want <i>column labels</i> to reflect the respective electrode location, simplifying the task of further modifications to the spatial filter.
Also, specifying <i>row labels</i> to identify output channels allows you to use those labels in configuration of further stages of processing, such as the <a href="User_Reference%253ALinearClassifier.html" title="User Reference:LinearClassifier">LinearClassifier</a>.
</p>
<a name="Sparse_Matrix_Filter_Type"></a><h4>Sparse Matrix Filter Type</h4>
<p>The sparse matrix filter uses the SpatialFilter parameter to define the relationship between input channels and output channels with a given weight. In this case, the SpatialFilter matrix must have 3 columns, and a row for each input/output relationship. The first column contains the input channel, the third column defines the weight that the input channel is multiplied by before being assigned to the output channel, which is defined in the second column.
</p><p>When specifying input channels in the first column, you may use <a href="User_Reference%253ADataIOFilter.html#ChannelNames" title="User Reference:DataIOFilter">channel names</a>. In order to assign labels to output channels in sparse representation, use arbitrary labels in the (second) output channel column. You may also re-use input channel labels but you should not do so except when there exists a clear relation between input and output channels with the same name, as it is the case in Laplacian filtering (see below).
</p><p>In order to allow for re-usability of sparse matrix filter configurations, it is not necessary for all specified input channels to exist in the current configuration. In case of missing input channels, only those output channels will be created for which all input channels exist. This way, it is possible to use the Laplacian configurations at <tt>parms/fragments/spatial_filters</tt> with only a subset of the channels specified there.
</p><p>See the example below for more information on how to use the sparse matrix.
</p>
<a name="SpatialFilterCAROutput"></a><h3>SpatialFilterCAROutput</h3>
<p>This parameter is a list of channels that define which channels should be output from the common average reference spatial filter, and the order in which they should appear. That is, the location of the channel in this list determines the output channel position. For example, if input channels 6, 7, 10, and 12 should be passed to the output of the spatial filter as channels 3, 4, 1, and 2, then this parameter should be set to:
</p><p><code>10 12 6 7</code>
</p><p>Rather than numbers, channel names may be specified as defined in the <a href="User_Reference%253ADataIOFilter.html#ChannelNames" title="User Reference:DataIOFilter">ChannelNames</a> parameter:
</p><p><code>C3 C4 CP3 CP4 Cz</code>
</p><p>It is important to note that <b>all</b> channels passed to the spatial filter (typically defined in the <a href="User_Reference%253AParameters.html#TransmitChList" title="User Reference:Parameters">TransmitChList parameter</a>) are used in the CAR calculation, but only a subset of these channels are actually output and passed to the next step in the signal processing chain.
</p><p>If this parameter is left blank, then all input channels are passed to the output, and the number of input channels equals the number of output channels.
</p>
<a name="SpatialFilterMissingChannels"></a><h3>SpatialFilterMissingChannels</h3>
<p>This parameter determines what happens when the SpatialFilter configuration contains channels that are not present in the input signal. Typically, this should be reported as a configuration error. However, when using pre-defined parameter fragments, it is more appropriate to silently suppress output channels that depend on missing input channels. This parameter provides the following values:
</p>
<dl><dt>0 Ignore
</dt><dd>The configuration is silently adapted to use available channels. Output channels are removed if they depend on a missing input channel.
</dd><dt>1 Report Error
</dt><dd>There is an error message generated for each channel missing from the input signal. This is the default.
</dd></dl>
<a name="States"></a><h2>States</h2>
<p>None.
</p>
<a name="Examples"></a><h2>Examples</h2>
<a name="Linked_Mastoids_.28Full_Matrix.29"></a><h3>Linked Mastoids (Full Matrix)</h3>
<p>Physical reference is to the left mastoid (A1). The right mastoid (A2) is recorded vs A1 on channel 1. All other electrodes are recorded vs A1 as well, and use the remaining channels.
In your spatial filter, you will want to re-reference all channels against "linked mastoids", i.e. against the mean of A1 and A2.
</p><p>In the spatial filter matrix, you want to subtract half of the A2 channel from each of the remaining channels:
</p>
<table border="1" cellspacing="0" style="text-align:center">
<caption> Linked Mastoids
</caption><tr>
<th> &nbsp; </th><th> A2  </th><th> Fz </th><th> Cz </th><th> Pz </th><th> ...
</th></tr>
<tr>
<th> Fz'
</th><td> -1/2 </td><td>  1 </td><td>  0 </td><td>  0 </td><td rowspan="3"> ...
</td></tr>
<tr>
<th> Cz'
</th><td> -1/2 </td><td>  0 </td><td>  1 </td><td>  0
</td></tr>
<tr>
<th> Pz'
</th><td> -1/2 </td><td>  0 </td><td>  0 </td><td>  1
</td></tr>
<tr>
<td> &nbsp; </td><td colspan="5"> ...
</td></tr></table>
<p><br />
</p>
<a name="Sparse_Matrix"></a><h3>Sparse Matrix</h3>
<p>In this example, the mean of channels 1-4 are passed to output channel 1, and the negative mean of channels 10-14 are passed to output channel 2. The SpatialFilter matrix definition is given below.
</p>
<table border="1" cellspacing="0" cellpadding="3" style="text-align:center">
<caption> Sparse Matrix
</caption><tr>
<th> &nbsp; </th><th> In </th><th> Out </th><th> Wt
</th></tr>
<tr>
<th> 1
</th><td> 1 </td><td> 1 </td><td> .25
</td></tr>
<tr>
<th> 2
</th><td> 2 </td><td> 1 </td><td> .25
</td></tr>
<tr>
<th> 3
</th><td> 3 </td><td> 1 </td><td> .25
</td></tr>
<tr>
<th> 4
</th><td> 4 </td><td> 1 </td><td> .25
</td></tr>
<tr>
<th> 5
</th><td> 10 </td><td> 2 </td><td> -.2
</td></tr>
<tr>
<th> 6
</th><td> 11 </td><td> 2 </td><td> -.2
</td></tr>
<tr>
<th> 7
</th><td> 12 </td><td> 2 </td><td> -.2
</td></tr>
<tr>
<th> 8
</th><td> 13 </td><td> 2 </td><td> -.2
</td></tr>
<tr>
<th> 9
</th><td> 14 </td><td> 2 </td><td> -.2
</td></tr>
</table>
<p>This results in:<br />
<code>OutCh(1) = 0.25*InCh(1) + 0.25*InCh(2) + 0.25*InCh(3) + 0.25*InCh(4)</code><br />
<code>OutCh(2) = (-0.2)*InCh(10) + (-0.2)*InCh(11) + (-0.2)*InCh(12) + (-0.2)*InCh(13) + (-0.2)*InCh(14)</code>
</p>
<a name="Large_Laplacian_.28Sparse_Matrix.29"></a><h3>Large Laplacian (Sparse Matrix)</h3>
<p>In this example, the spatial filter computes Large-Laplacian filtered versions of channels <i>C3</i> and <i>C4</i> by re-referencing them to the mean of their mid-range neighbors <i>Cz</i>, <i>P3/4</i>, <i>T7/8</i>, and <i>F3/4</i>:<br />
</p><p><code>C3'=C3-(Cz+P3+T7+F3)/4</code><br />
<code>C4'=C4-(Cz+P4+T8+F4)/4</code>
</p><p>Using channel names, the filter specification will be independent of the order and exact set of input channels, provided that all required channels are available and labeled correctly.
</p>
<table border="1" cellspacing="0" cellpadding="3" style="text-align:center">
<caption> Sparse Matrix
</caption><tr>
<th> &nbsp; </th><th> In </th><th> Out </th><th> Wt
</th></tr>
<tr>
<th> 1
</th><td> C3 </td><td> C3 </td><td> 1
</td></tr>
<tr>
<th> 2
</th><td> Cz </td><td> C3 </td><td> -.25
</td></tr>
<tr>
<th> 3
</th><td> P3 </td><td> C3 </td><td> -.25
</td></tr>
<tr>
<th> 4
</th><td> T7 </td><td> C3 </td><td> -.25
</td></tr>
<tr>
<th> 5
</th><td> F3 </td><td> C3 </td><td> -.25
</td></tr>
<tr>
<th> 6
</th><td> C4 </td><td> C4 </td><td> 1
</td></tr>
<tr>
<th> 7
</th><td> Cz </td><td> C4 </td><td> -.25
</td></tr>
<tr>
<th> 8
</th><td> P4 </td><td> C4 </td><td> -.25
</td></tr>
<tr>
<th> 9
</th><td> T8 </td><td> C4 </td><td> -.25
</td></tr>
<tr>
<th> 10
</th><td> F4 </td><td> C4 </td><td> -.25
</td></tr></table>
<p><b>Note:</b> This subset of a Large Laplacian filter is only provided as an illustration. BCI2000 provides full Small and Large Laplacian filter configurations in <tt>parms/fragments/spatial_filters</tt>.
</p>
<a name="Performance_Notes"></a><h2>Performance Notes</h2>
<p>Each spatial filter type uses a different algorithm to compute the linear transformation, and can therefore have implications on CPU load and performance. In the following, <span class="texhtml"><i>N</i></span> denotes the filter's number of input channels, and <img class='tex' src="../images/math/0/f/4/0f40d29daf45fd641ba8d2ddfdd493aa.png" alt="M \leq N" /> denotes its number of output channels.
</p>
<a name="None"></a><h3>None</h3>
<p>No computations are actually done, but input data is being copied into the filter's output, resulting in a complexity <span class="texhtml"><i>O</i>(<i>N</i>)</span>.
</p>
<a name="CAR"></a><h3>CAR</h3>
<p>The common-average reference has a complexity of <span class="texhtml"><i>O</i>(<i>N</i> + <i>M</i>)</span>, providing the next best performance in most circumstances. It is possible to create a CAR using either the full-matrix or sparse matrix options; however, the CAR method only calculates the mean value once per sample, and subtracts it only from the selected output channels. In order to implement a CAR in a full-matrix, the mean must be recalculated for <i>every</i> output channel, which is not as efficient, particularly for high channel count systems.
</p>
<a name="Sparse_Matrix_2"></a><h3>Sparse Matrix</h3>
<p>The sparse matrix method performance is determined completely by the number of elements (rows) in the <i>SpatialFilter</i> matrix. In the best case, a single channel is multiplied by the weight and assigned to the specified output channel; this would take far less CPU time than the CAR method, and possibly the "none" option as well. 
</p><p>In a realistic scenario, all <span class="texhtml"><i>N</i></span> input channels will be used to calculate <img class='tex' src="../images/math/0/f/4/0f40d29daf45fd641ba8d2ddfdd493aa.png" alt="M \leq N" /> output channels; thus, complexity is between <span class="texhtml"><i>O</i>(<i>N</i>)</span> and <span class="texhtml"><i>O</i>(<i>N</i> * <i>M</i>)</span>, with <span class="texhtml"><i>O</i>(<i>N</i><sup>2</sup>)</span> in the worst case.
</p><p>Sparse matrix worst-case performance will be close to that of an <img class='tex' src="../images/math/3/9/5/395a9af17f8642e02a32af8637542947.png" alt="N\times N" /> "full" spatial filter matrix. Thus, for spatial filter configurations that depend on electrode/sensor locations such as Laplacian filtering, filter definition in terms of a sparse matrix using <a href="User_Reference%253ADataIOFilter.html#ChannelNames" title="User Reference:DataIOFilter">channel labels</a> appears most advantageous.
</p>
<a name="Full_Matrix"></a><h3>Full Matrix</h3>
<p>Full matrix representation is the most general way to specify a spatial filter, and recommended for situations not allowed for by the remaining spatial filter types.
Compared to those, it is associated with a number of disadvantages:
</p>
<ul><li>Complexity of matrix-vector multiplication is <span class="texhtml"><i>O</i>(<i>N</i><i>M</i>)</span>. In situations with large sampling rates and/or a large number of channels, this may result in real-time problems due to high CPU load.
</li><li><a href="User_Reference%253ADataIOFilter.html#ChannelNames" title="User Reference:DataIOFilter">Channel labels</a> are not preserved across the filter. Due to the filter's general nature, no relation between input and output channel names can be inferred, and all output labels must be specified manually.
</li><li>The filter's specification depends on the order of input channels, which makes it interdependent with the <a href="User_Reference%253AParameters.html#TransmitChList" title="User Reference:Parameters"><i>TransmitChList</i> parameter</a>.
</li><li>On multiprocessor systems, computation of a full-matrix type spatial filter is performed by multiple threads, one per processor core, such that the system's multiprocessing capability is fully utilized.
</li></ul>
<a name="See_also"></a><h2>See also</h2>
<p><a href="User_Reference%253ALinearClassifier.html" title="User Reference:LinearClassifier">User Reference:LinearClassifier</a>, <a href="User_Reference%253ADataIOFilter.html#ChannelNames" title="User Reference:DataIOFilter">User Reference:DataIOFilter#ChannelNames</a>
</p>
<div class="printfooter">
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'></td></tr></table>
</div>
</div>

<div id='quickbar'>
<table class="image"><caption align="bottom"><h2>BCI2000 Help</h2></caption><tr><td><a href="BCI2000_Help.html"><img src='../../images/bci2000logo_small.png' height=100 width=100 alt='[BCI2000 Help]' /></a></td></tr></table>
<hr class='sep' /><a href="User_Tutorial%253ABCI2000_Tour.html">Getting Started</a><br />
<a href="User_Reference%253AContents.html">User Manual</a><br />
<ul><li><a href="User_Reference%253AOperator_Module.html">Operator Module</a></li>
<li><a href="User_Reference%253AFilters.html">Configuration Guide</a></li>
<li>Applications</li>
<li>Tools</li>
</ul><a href="Technical_Reference%253AContents.html">Technical Reference</a><br />
<a href="Programming_Reference%253AContents.html">Programming Manual</a><br />
<a href="Contributions%253AContents.html">Contributions</a><br />
<hr class='sep' />
<a href="BCI2000_Glossary.html">BCI2000 Glossary</a><br />
</div>

</body></html>
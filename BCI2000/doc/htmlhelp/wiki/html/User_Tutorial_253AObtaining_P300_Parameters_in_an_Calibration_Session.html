<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<head>
<title>User Tutorial:Obtaining P300 Parameters in an Calibration Session - BCI2000 Help</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="User Tutorial:Obtaining P300 Parameters in an Calibration Session,User Tutorial:P300 GUI for Offline Analysis Tutorial,User Tutorial:Performing a P300 Spelling Session" />
<link rel="shortcut icon" href="../../favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../skins/common/wikiprintable.css' />
<link rel="stylesheet" href="../skins/common/wikistandard.css@1" type="text/css" />
<link rel="stylesheet" href="../skins/common/common.css" type="text/css" />
<link rel="stylesheet" href="../skins/common/htmlhelp.css" type="text/css" />

<style type='text/css'>
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px;  }
#article { margin-left: 152px; margin-right: 4px; }
</style>
</head>

<body bgcolor='#FFFFFF'>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
</tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">Obtaining P300 Parameters in an Calibration Session</h1><p class="subtitle">User Tutorial</p><hr class="sep" /><table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_an_Calibration_Session.html#Obtaining_P300_Parameters_in_the_Calibration_Session"><span class="tocnumber">1</span> <span class="toctext">Obtaining P300 Parameters in the Calibration Session</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_an_Calibration_Session.html#Design_of_Calibration_Session"><span class="tocnumber">2</span> <span class="toctext">Design of Calibration Session</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_an_Calibration_Session.html#Performing_the_Configuration_Session"><span class="tocnumber">3</span> <span class="toctext">Performing the Configuration Session</span></a></li>
<li class='toclevel-1'><a href="User_Tutorial%253AObtaining_P300_Parameters_in_an_Calibration_Session.html#Analyzing_The_Calibration_Session_with_Offline_Analysis"><span class="tocnumber">4</span> <span class="toctext">Analyzing The Calibration Session with Offline Analysis</span></a></li>
</ul>
</td></tr></table>
<a name="Obtaining_P300_Parameters_in_the_Calibration_Session"></a><h2>Obtaining P300 Parameters in the Calibration Session</h2>
<p>Although the basic properties of the P300 evoked potential are the same for all individuals, the response's latency, width, and spatial pattern varies, and adaptation to individual parameters improves accuracy.
</p><p>Thus, it is necessary to obtain these individual parameters prior to performing spelling experiments.
</p>
<a name="Design_of_Calibration_Session"></a><h2>Design of Calibration Session</h2>
<p>During the calibration session, the volunteer is asked to spell out a given word by using a P300 character matrix, pictured below. During each run, the volunteer is asked to focus on the next letter in the word they are spelling, as the rows and columns flash randomly and successively so that sometimes the flashing corresponds to the column or row containing the target character and sometimes it will not. As the volunteer counts the number of times the desired letter in the word flashes, a P300 response is generated. The purpose of the calibration session is to identify those features that discriminate between the desired and undesired rows/columns. 
</p><p><a href="../images/thumb/e/ea/P3SpellerMatrix.PNG/298px-P3SpellerMatrix.PNG" class="image" title=""><img src="../images/thumb/e/ea/P3SpellerMatrix.PNG/298px-P3SpellerMatrix.PNG" alt="" width="298" height="297" longdesc="/wiki/index.php/Image:P3SpellerMatrix.PNG" /></a>
</p><p>After the first few runs are collected, an analysis tool will be used to generate a configuration file with weights that will determine what portions of the input data correspond to selecting the desired letter. These weights are applied to the configuration session for one more run, and then the data from this run is also analyzed with the MatLab tool, and the number of flashes needed to ensure 100% accuracy is determined. The second configuration file generated and applied. This final set of parameters are saved as that volunteer’s parameter file for future spelling sessions.
</p>
<a name="Performing_the_Configuration_Session"></a><h2>Performing the Configuration Session</h2>
<ul><li>Start BCI2000 by running <tt>batch/P3Speller_&lt;Your_Amplifier&gt;.bat</tt>
</li><li>Press <b>Config</b>, and load the baseline parameters for copy spelling that you made earlier.
</li><li>In the <b>Storage</b> tab:
<ul><li>Set <i>SubjectName</i> to the volunteer’s initials.
</li><li>Set <i>SubjectSession</i> to <tt>001</tt>
</li><li>Set <i>SubjectRun</i> to <tt>01</tt>
</li></ul>
</li><li>In the <b>Application</b> tab:
<ul><li>Make sure that <i>InterpretMode</i> is set to <tt>copy mode</tt>, and <i>DisplayResults</i> (directly below InterpretMode) is unchecked
</li><li>Find the <i>TextToSpell</i> field. This should be set to ‘THE’, and you will be changing it after each run. 
</li></ul>
</li><li>Press <b>Set Config</b> to apply this configuration.
</li></ul>
<ul><li>Request that the volunteer sit in a relaxed position, and that the volunteer not move or speak during the runs.
</li><li>Turning off or dimming the lights can improve volunteer focus and performance.
</li><li>Showing the brain wave readouts to the volunteer can drive in the message of how artifact-generating behavior can be detrimental to the data.
</li><li>Press <b>Start</b> to show the flashing character matrix, and describe what the volunteer is expected to do.
</li><li>After you’ve explained the procedure, click <b>Suspend</b> to stop the process.
</li><li>Delete that run of data (The file should be named <tt>data\P300\&lt;Volunteer's Initials&gt;001R01.dat</tt>)
</li></ul>
<ul><li>Press <b>Start</b> to record the run.
</li><li>Once it has finished automatically, click <b>Config</b> and change the <i>TextToSpell</i> in the <b>Application</b> tab to <tt>QUICK</tt>.
</li><li>Press <b>Start</b> to record the run.
</li><li>Once it has finished automatically, click <b>Config</b> and change the <i>TextToSpell</i> in the <b>Application</b> tab to <tt>BROWN</tt>.
</li><li>Press <b>Start</b> to record the run.
</li><li>Once it has finished automatically, click <b>Config</b> and change the <i>TextToSpell</i> in the <b>Application</b> tab to <tt>FOX</tt>.
</li><li>Press <b>Start</b> to record the run.
</li><li>Once this recording has finished, close BCI2000 and locate the saved data files
</li></ul>
<a name="Analyzing_The_Calibration_Session_with_Offline_Analysis"></a><h2>Analyzing The Calibration Session with Offline Analysis</h2>
<p>We will now perform an ‘Offline Analysis’ with a tool provided with the BCI2000 system.
</p>
<div class="floatright"><span><a href="../images/8/89/OfflineGUI.PNG" class="image" title=""><img src="../images/8/89/OfflineGUI.PNG" alt="" width="554" height="507" longdesc="/wiki/index.php/Image:OfflineGUI.PNG" /></a></span></div>
<ul><li>Run <tt>tools/OfflineAnalysis/OfflineAnalysis.bat</tt>
</li><li>In the <i>Analysis Domain</i> field, choost <b>Time (P300)</b>
</li><li>In the <i>Acquisition Type</i> field, choose <b>EEG</b>
</li><li>Next to <i>Spatial Filter</i>, choose <b>None</b>
</li><li>For <b>Trial Change Condition</b> enter <tt>states.StimulusBegin == 1</tt>
</li><li>For <b>Target Condition 1</b> enter <tt>(states.StimulusCode &gt; 0) &amp; (states.StimulusType == 1)</tt>
</li><li>For <b>Target Condition Label 1</b> enter <tt>Attended Stimuli</tt>
<ul><li>‘Attended Stimuli’ refers to the letter or character the person is counting the flashes of, and triggers when the correct stimulus is shown
</li></ul>
</li><li>For <b>Target Condition 2</b> enter <tt>(states.StimulusCode &gt; 0) &amp; (states.StimulusType == 0)</tt>
</li><li>For <b>Target Condition Label 2</b> enter <tt>Unattended Stimuli</tt>
<ul><li>‘Unattended stimulus’ refers to the letters or characters the person is not counting the flashes of, and triggers when an incorrect stimulus is shown 
</li></ul>
</li><li>Click the <i>‘Add</i>’ button by <i>Data Files</i>
</li><li>In this new dialog, select all of the data files taken during this configuration session, and click ‘<i>Open</i>’
</li></ul>
<ul><li>Click ‘<i>Generate Plots</i>’ and wait for the feature plot to appear
</li></ul>
<table>
<tr>
<td height="160px">
</td></tr></table>
<div class="floatright"><span><a href="../images/thumb/a/a9/FeaturesPlot.PNG/500px-FeaturesPlot.PNG" class="image" title=""><img src="../images/thumb/a/a9/FeaturesPlot.PNG/500px-FeaturesPlot.PNG" alt="" width="500" height="472" longdesc="/wiki/index.php/Image:FeaturesPlot.PNG" /></a></span></div>
<ul><li>When this is complete, you will see a feature plot similar to the one to the right. The vertical axis corresponds to the locations while the horizontal corresponds to the time delay after the stimulus. The color coding shows the r-squared value of that datapoint, the darker the color indicating a higher predictability that it is produced by the desired letter being flashed.
</li><li>The darkest of these r-squared values between 250 and 550ms are what we are interested in. Pick the 4 points with the largest r-squared values between these times and record their time points and channels. The plot’s '‘Data Cursor’' tool (Tools Menu &rarr; Data Cursor) allows for discrete identification of time points.
</li></ul>
<ul><li>With these four points, close the feature plot, and enter the channel numbers of the data points you found into the '‘Waveform Channels’' field and the time points into the ‘'Topo Times'’ field.
<ul><li>In the example above, the four best data points have r-squared values <tt>0.02218</tt>, <tt>0.02179</tt>, <tt>0.01928</tt>, and <tt>0.019</tt>, occur at times <tt>388.7ms</tt>, <tt>392.6ms</tt>, <tt>384.8ms</tt>, and <tt>365.2ms</tt> respectively, and all four are detected by channel six. <tt>6, 6, 6, 6</tt> would be entered into '‘Waveform Channels'’ and <tt>388.7, 392.6, 384.8, 365.2</tt> would be entered into the ‘'Topo Times’' field. The order of the data points here does not matter, only that they are in the same order in both fields.
</li><li>If there are less than four points that seem appropriate, either they are at the wrong electrodes, at the wrong times, or simply have too low of an r-squared value, that is fine, three or two values can work, though the fewer values used the lower the accuracy will be. 
</li></ul>
</li><li>Click ‘<i>Generate Plots’</i> to create the features plot again with a set of four graphs that show the correlation between the selected times after the desired stimuli is given (the red line) and the brain’s responses to when the desired stimuli is not given (the blue line).
<ul><li>As seen below, the attended-stimuli reaction will typically be stronger than the unattended-stimuli, but in some cases the reverse is true. If the ‘unattended’ curve is larger than the ‘attended’ curve then make a note of this before moving on. The waveform seen here is similar to the others generated, only one is shown here for simplicity.
</li><li>Additionally before moving on, determine the location of the response seen. The P300 response is generally observed centered on the Cz electrode, or just behind and directly in between the ears, and does not involve the frontal regions of the brain. Assuming these characteristics are present, it is proper to proceed.
</li></ul>
</li></ul>
<div class="center"><div class="floatnone"><span><a href="../images/thumb/1/1d/Waveform.PNG/800px-Waveform.PNG" class="image" title=""><img src="../images/thumb/1/1d/Waveform.PNG/800px-Waveform.PNG" alt="" width="800" height="391" longdesc="/wiki/index.php/Image:Waveform.PNG" /></a></span></div></div>
<p><br />
</p><p><br />
</p>
<ul><li>Now we will save these customizations to a volunteer-specific parameters file that will allow the volunteer to free-spell with very high accuracy.
</li><li>Start BCI2000 using <tt>batch/P3Speller_&lt;Your_Amplifier&gt;.bat</tt> file
</li><li>Click ‘<i>Config</i>’, and load the <tt>P300_copy_speller_&lt;Your_Amplifier&gt;.prm</tt> made previously
</li><li>Under the ‘<i>Filtering’</i> tab, click the <i>‘Edit Matrix</i>’ button by '‘Classifier’' near the bottom
</li><li>Change this matrix to have 4 columns and however many rows as values as you are using, and click ‘<i>Set New Matrix Size’</i>
<ul><li>In the first column, labeled '‘Input Channel'’, enter the channel of the first value you use
</li><li>In the second column, labeled ‘'Input Element (bin)'’, enter the time of the best classification, immediately followed with <tt>ms</tt>, as in <tt>388.7ms</tt>
</li><li>In the third column, enter 1 as the output channel
</li><li>In the fourth column, enter 1 if the <i>Attended</i> line was larger than the <i>Unattended</i> line, -1 if the <i>unattended</i> line was larger than the <i>attended</i> line
</li><li>Repeat these steps for the remaining rows
</li></ul>
</li><li>Close this matrix, and click <i>‘Save Parameters</i>’ to save this file, naming it however you deem fit
</li><li>Use this new parameter file to repeat the configuration session a few times, adding new rows to the classifier matrix each time for the new data points to be utilized.
</li><li>When accuracy is reliably above 90%, click <i>‘Config</i>’, go to the ‘<i>Application’</i> tab, and delete the contents of the '‘Text to Spell'’ field, set '‘InterpretMode’' to <tt>online free mode</tt>, and make sure the '‘DisplayResults’' box is checked
</li><li>Click ‘<i>Save Parameters’</i>, and change the <tt>copy_spell</tt> portion of this parameter file name to <tt>free_spell</tt>
</li><li>This parameter file is now ready to use for that specific volunteer for future P300 spelling experiments
</li></ul>
<p><br />
One program contributed to, and provided with, the BCI2000 system is the P300 GUI. This program utilizes MatLab R2007a to automatically sift through data files for datapoints indicative of a positive P300 reaction, and build a classifier matrix with those datapoints. The largest benefit to using this program is the obviated need for repeat configuration sessions, at the expense of decreased hands-on experience with the BCI2000 program itself. For a tutorial on how to perform the offline analysis with this GUI program, <a href="User_Tutorial%253AP300_GUI_for_Offline_Analysis_Tutorial.html" title="User Tutorial:P300 GUI for Offline Analysis Tutorial">please click here</a>.
</p><p><br />
To continue onto performing P300 spelling experiments, continue to <a href="User_Tutorial%253APerforming_a_P300_Spelling_Session.html" title="User Tutorial:Performing a P300 Spelling Session">Performing a P300 Spelling Session</a>.
</p>
<div class="printfooter">
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'></td></tr></table>
</div>
</div>

<div id='quickbar'>
<table class="image"><caption align="bottom"><h2>BCI2000 Help</h2></caption><tr><td><a href="BCI2000_Help.html"><img src='../../images/bci2000logo_small.png' height=100 width=100 alt='[BCI2000 Help]' /></a></td></tr></table>
<hr class='sep' /><a href="User_Tutorial%253ABCI2000_Tour.html">Getting Started</a><br />
<ul><li><a href="User_Tutorial%253ABCI2000_Tour.html">Tour</a></li>
<li><a href="User_Tutorial%253AMu_Rhythm_BCI_Tutorial.html">Mu Tutorial</a></li>
<li><a href="User_Tutorial%253AP300_BCI_Tutorial.html">P300 Tutorial</a></li>
</ul><a href="User_Reference%253AContents.html">User Manual</a><br />
<a href="Technical_Reference%253AContents.html">Technical Reference</a><br />
<a href="Programming_Reference%253AContents.html">Programming Manual</a><br />
<a href="Contributions%253AContents.html">Contributions</a><br />
<hr class='sep' />
<a href="BCI2000_Glossary.html">BCI2000 Glossary</a><br />
</div>

</body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<head>
<title>User Reference:Matlab MEX Files - BCI2000 Help</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="keywords" content="User Reference:Matlab MEX Files,BCI2000 Binaries,Contributions:FilterGUI,Programming Reference:BCI2000 Source Code,User Reference:ARFilter,User Reference:Data File Formats,User Reference:Matlab Tools" />
<link rel="shortcut icon" href="../../favicon.ico" />
<link rel='stylesheet' type='text/css' media='print' href='../skins/common/wikiprintable.css' />
<link rel="stylesheet" href="../skins/common/wikistandard.css@1" type="text/css" />
<link rel="stylesheet" href="../skins/common/common.css" type="text/css" />
<link rel="stylesheet" href="../skins/common/htmlhelp.css" type="text/css" />

<style type='text/css'>
a.new, #quickbar a.new { color: #CC2200; }
.editsection { display: none; }
#quickbar { position: absolute; top: 4px; left: 4px;  }
#article { margin-left: 152px; margin-right: 4px; }
</style>
</head>

<body bgcolor='#FFFFFF'>

<div id='content'>
<div id='topbar'>
<table border='0' cellspacing='0' width='98%'>
<tr>
</tr>
</table>
</div>

<div id='article'>
<h1 class="pagetitle">Matlab MEX Files</h1><p class="subtitle">User Reference</p><hr class="sep" /><table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="User_Reference%253AMatlab_MEX_Files.html#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class='toclevel-1'><a href="User_Reference%253AMatlab_MEX_Files.html#Using_BCI2000_MEX_files"><span class="tocnumber">2</span> <span class="toctext">Using BCI2000 MEX files</span></a>
<ul>
<li class='toclevel-2'><a href="User_Reference%253AMatlab_MEX_Files.html#Microsoft_Windows_32"><span class="tocnumber">2.1</span> <span class="toctext">Microsoft Windows 32</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253AMatlab_MEX_Files.html#Other_platforms"><span class="tocnumber">2.2</span> <span class="toctext">Other platforms</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="User_Reference%253AMatlab_MEX_Files.html#Building_BCI2000_MEX_files"><span class="tocnumber">3</span> <span class="toctext">Building BCI2000 MEX files</span></a></li>
<li class='toclevel-1'><a href="User_Reference%253AMatlab_MEX_Files.html#BCI2000_MEX_functions"><span class="tocnumber">4</span> <span class="toctext">BCI2000 MEX functions</span></a>
<ul>
<li class='toclevel-2'><a href="User_Reference%253AMatlab_MEX_Files.html#load_bcidat"><span class="tocnumber">4.1</span> <span class="toctext">load_bcidat</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253AMatlab_MEX_Files.html#save_bcidat"><span class="tocnumber">4.2</span> <span class="toctext">save_bcidat</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253AMatlab_MEX_Files.html#convert_bciprm"><span class="tocnumber">4.3</span> <span class="toctext">convert_bciprm</span></a></li>
<li class='toclevel-2'><a href="User_Reference%253AMatlab_MEX_Files.html#mem"><span class="tocnumber">4.4</span> <span class="toctext">mem</span></a></li>
</ul>
</li>
<li class='toclevel-1'><a href="User_Reference%253AMatlab_MEX_Files.html#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</td></tr></table>
<a name="Introduction"></a><h2>Introduction</h2>
<p>MEX files allow the execution of externally compiled code from within Matlab. Because Matlab code is interpreted at runtime, and MEX files contain binary code that has been compiled prior to use, MEX files are generally faster than equivalent Matlab code.
</p><p>BCI2000 MEX files contain code that interfaces with BCI2000-specific data structures, i.e. BCI2000 data files, and parameter definitions. This allows access to BCI2000 data from Matlab, without duplicating code that implements those data structures.
</p><p>Higher-level Matlab routines for data-analysis and management, which make use of these mex files,  are documented on the <a href="User_Reference%253AMatlab_Tools.html" title="User Reference:Matlab Tools">Matlab tools</a> page.
</p>
<a name="Using_BCI2000_MEX_files"></a><h2>Using BCI2000 MEX files</h2>
<a name="Microsoft_Windows_32"></a><h3>Microsoft Windows 32</h3>
<p>The BCI2000 <a href="BCI2000_Binaries.html" title="BCI2000 Binaries">binary distribution</a> comes with pre-compiled MEX files for 32-bit Microsoft Windows platforms.
Add <tt>BCI2000/tools/mex</tt> to your Matlab path to use these files.
</p>
<a name="Other_platforms"></a><h3>Other platforms</h3>
<p>BCI2000 comes with pre-built MEX files for a number of platforms, including 64-bit Windows, Mac OS X, and Linux for the i386 as well as the amd64 architecture. Support for these MEX files is <i>experimental</i> at present, and they may or may not work on your particular configuration.
On 64-bit Windows, the MEX files require the Visual Studio runtime libraries. If you want to use them on a machine that doesn't have Visual Studio installed, you will need to install the <a href="http://www.bci2000.org/downloads/bin/vcredist_x64.exe" class='external text' title="http://www.bci2000.org/downloads/bin/vcredist_x64.exe" rel="nofollow">Visual Studio runtime libraries</a> first.
</p>
<a name="Building_BCI2000_MEX_files"></a><h2>Building BCI2000 MEX files</h2>
<p>Typically, you will use pre-built binary versions of BCI2000 MEX files as described above. If you need to build BCI2000 MEX files yourself, the following information applies.
BCI2000 provides a Matlab script that can be used to build MEX files.
</p>
<ul><li>After downloading the <a href="Programming_Reference%253ABCI2000_Source_Code.html" title="Programming Reference:BCI2000 Source Code">BCI2000 source code</a>, start Matlab and make sure that the mex command is configured to use a compiler that is able to compile C++ code. On Windows platforms, you may use the compiler included with the freely available Windows SDK. On Unix platforms, you will typically use the gcc compiler. Typing <tt>help mex</tt> from the Matlab command line will guide you in configuring the mex command.
</li><li>Change Matlab's working directory to <tt>BCI2000/src/core/Tools/mex/</tt>.
</li><li>Execute <tt>buildmex</tt> from the Matlab command line.
</li><li>Add <tt>BCI2000/tools/mex</tt> to your Matlab path to use the newly built MEX files.
</li><li>On Unix-based platforms, Matlab creates its own execution environment for MEX files, independently of system libraries. For MEX files, this means that they usually won't work unless compiled with a version of the <a href="http://gcc.gnu.org" class='external text' title="http://gcc.gnu.org" rel="nofollow">gcc compiler</a> that matches the one used to build Matlab itself, and linked against libraries that match the ones used by Matlab. To check, see the <a href="http://www.mathworks.com/support/compilers/current_release/" class='external text' title="http://www.mathworks.com/support/compilers/current_release/" rel="nofollow">list of compatible compiler versions</a>.
</li></ul>
<a name="BCI2000_MEX_functions"></a><h2>BCI2000 MEX functions</h2>
<a name="load_bcidat"></a><h3><tt>load_bcidat</tt></h3>
<pre> [ signal, states, parameters, total_samples, file_samples ] ...
    = load_bcidat( 'filename1', 'filename2', ... )
</pre>
<p>loads signal, state, and parameter data from the files whose names are given
as function arguments.
</p><p>Examples for loading multiple files:
</p>
<pre>files = dir( '*.dat' );
[ signal, states, parameters ] = load_bcidat( files.name );

files = struct( 'name', uigetfile( 'MultiSelect', 'on' ) );
[ signal, states, parameters ] = load_bcidat( files.name );
</pre>
<p>For multiple files, number of channels, states, and signal type must be
consistent.
</p><p>By default, signal data will be in raw A/D units, and will be represented by the 
smallest Matlab data type that accommodates them.
To obtain signal data calibrated into physical units (microvolts),
specify '-calibrated' as an option anywhere in the argument list.
</p><p>The 'states' output variable will be a Matlab struct with BCI2000 state
names as struct member names, and the number of state value entries matching
the first dimension of the 'signal' output variable.
</p><p>The 'parameters' output variable will be a Matlab struct with BCI2000
parameter names as struct member names.
Individual parameter values are represented as cell arrays of strings in a 
'Value' struct member, and additionally as numeric matrices in a 'NumericValue'
struct member. When there is no numeric interpretation possible, the 
corresponding matrix entry will be NaN. For nested matrices, no NumericValue
field is provided.
When multiple files are given, parameter values will match the ones contained 
in the first file.
</p><p>Optionally, sample ranges may be specified for individual files:
</p>
<pre>[ signal, states, parameters ] = load_bcidat( 'filename', [first last] )
</pre>
<p>will load a subset of samples defined by first and last sample index.
Specifying [0 0] for an empty sample range allows to read states and 
parameters from a file without reading sample data:
</p>
<pre>[ ignored, states, parameters ] = load_bcidat( 'filename', [0 0] );
</pre>
<p>The 'total_samples' output variable reports the total number of samples
present in all files, independently of how many samples have been
specified as sample ranges. This allows to retrieve the number of
samples in a file without actually loading the file:
</p>
<pre>[ ignored, states, parameters, total_samples ] = load_bcidat( 'filename', [0 0] );
</pre>
<p>Similarly, the 'file_samples' output variable provides a vector
containing the number of samples within each input file, regardless of
any sample ranges that may have been specified.
</p>
<pre>[ ignored, states, parameters, total_samples, file_samples ] = load_bcidat( 'filename1', [0 0], 'filename2', [0 0]  );
</pre>
<a name="save_bcidat"></a><h3><tt>save_bcidat</tt></h3>
<pre>save_bcidat( 'filename', signal, states, parameters );
</pre>
<p>saves signal, state, and parameter data into the named file.
</p><p>The signal, state, and parameter arguments must be Matlab structs as 
created by the <tt>load_bcidat</tt>, or <tt>convert_bciprm</tt> mex
files.
Signal data is always interpreted as raw data, i.e. it will be written
into the output file unchanged.
</p><p>The output file format is deduced from the output file's extension, 
which may be <i>.dat</i>, <i>.edf</i>, or <i>.gdf</i>. When no extension is recognized, 
the BCI2000 <i>dat</i> file format is used.
</p><p>For an example how to use <tt>save_bcidat</tt> in conjunction with <tt>load_bcidat</tt>,
see the <a href="Contributions%253AFilterGUI.html" title="Contributions:FilterGUI">FilterGUI</a> tool contribution.
</p>
<a name="convert_bciprm"></a><h3><tt>convert_bciprm</tt></h3>
<p>A Matlab (mex) subroutine that converts BCI2000 parameters
from Matlab struct into string representation and back.
</p>
<pre>parameter_lines = convert_bciprm( parameter_struct );
</pre>
<p>converts a BCI2000 parameter struct (as created by load_bcidat)
into a cell array of strings containing valid BCI2000 parameter
definition strings.
</p><p>When the input is a cell array rather than a Matlab struct, convert_bciprm
will interpret the input as a list of BCI2000 parameter definition strings (ignoring the NumericValue field if present).
</p>
<pre>parameter_struct = convert_bciprm( parameter_lines );
</pre>
<a name="mem"></a><h3><tt>mem</tt></h3>
<p>This command estimates a power spectrum, using the AR based spectral estimator
that is also present in the <a href="User_Reference%253AARFilter.html" title="User Reference:ARFilter">ARFilter</a>.
The calling syntax is:
</p>
<pre>[spectrum, frequencies] = mem(signal, parms);
</pre>
<p>with &lt;signal&gt; and &lt;spectrum&gt; having dimensions values x channels, and
with &lt;parms&gt; being a vector of parameter values:
</p>
<ul><li>model order,
</li><li>first bin center,
</li><li>last bin center,
</li><li>bin width,
</li><li>evaluations per bin,
</li><li>detrend option (optional, 0: none, 1: mean, 2: linear; defaults to none),
</li><li>sampling frequency (optional, defaults to 1).
</li></ul>
<p>For a detailed description of configuration parameters, see the <a href="User_Reference%253AARFilter.html" title="User Reference:ARFilter">User Reference:ARFilter</a> page.
</p>
<a name="See_also"></a><h2>See also</h2>
<p><a href="User_Reference%253AData_File_Formats.html" title="User Reference:Data File Formats">User Reference:Data File Formats</a>, <a href="User_Reference%253AARFilter.html" title="User Reference:ARFilter">User Reference:ARFilter</a>
</p>
<div class="printfooter">
</div>

</div><br style="clear:both" />

<div id='footer'><table border="0" cellspacing="0"><tr><td width='152' rowspan='1'>&nbsp;</td><td class='bottom' align='left' valign='top'></td></tr></table>
</div>
</div>

<div id='quickbar'>
<table class="image"><caption align="bottom"><h2>BCI2000 Help</h2></caption><tr><td><a href="BCI2000_Help.html"><img src='../../images/bci2000logo_small.png' height=100 width=100 alt='[BCI2000 Help]' /></a></td></tr></table>
<hr class='sep' /><a href="User_Tutorial%253ABCI2000_Tour.html">Getting Started</a><br />
<a href="User_Reference%253AContents.html">User Manual</a><br />
<ul><li><a href="User_Reference%253AOperator_Module.html">Operator Module</a></li>
<li><a href="User_Reference%253AFilters.html">Configuration Guide</a></li>
<li>Applications</li>
<li>Tools</li>
<ul><li><a href="User_Reference%253ABCI2000Launcher.html">BCI2000Launcher</a></li>
<li><a href="User_Reference%253ABCI2000Viewer.html">BCI2000Viewer</a></li>
<li><a href="User_Reference%253ABCI2000FileInfo.html">BCI2000FileInfo</a></li>
<li><a href="User_Reference%253ABCI2000Export.html">BCI2000Export</a></li>
<li><a href="User_Reference%253AEEGLabImport.html">EEGLabImport</a></li>
<li>Matlab MEX Files</li>
<li><a href="User_Reference%253ACommand_Line_Processing.html">Command Line Processing</a></li>
</ul></ul><a href="Technical_Reference%253AContents.html">Technical Reference</a><br />
<a href="Programming_Reference%253AContents.html">Programming Manual</a><br />
<a href="Contributions%253AContents.html">Contributions</a><br />
<hr class='sep' />
<a href="BCI2000_Glossary.html">BCI2000 Glossary</a><br />
</div>

</body></html>